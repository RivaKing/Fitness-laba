{% extends "base.html" %}

{% block title %}Профиль тренера - Фитнес Платформа{% endblock %}

{% block extra_css %}
<style>
    .trainer-header {
        background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
        border-radius: 10px;
        padding: 30px;
        color: white;
        margin-bottom: 30px;
        position: relative;
        overflow: hidden;
    }
    
    .trainer-header::before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 200px;
        height: 200px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        transform: translate(50%, -50%);
    }
    
    .trainer-avatar {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        border: 4px solid white;
        object-fit: cover;
        margin-bottom: 15px;
    }
    
    .rating-stars {
        color: #ffc107;
        font-size: 1.2rem;
    }
    
    .rating-number {
        font-size: 2rem;
        font-weight: bold;
        color: #333;
    }
    
    .rating-count {
        color: #6c757d;
        font-size: 0.9rem;
    }
    
    .stat-card {
        border: none;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        transition: transform 0.3s ease;
        height: 100%;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
    }
    
    .stat-icon {
        width: 50px;
        height: 50px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        margin-bottom: 15px;
    }
    
    .stat-value {
        font-size: 2rem;
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 5px;
    }
    
    .stat-label {
        color: #6c757d;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .social-link {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #f8f9fa;
        color: #495057;
        text-decoration: none;
        transition: all 0.3s ease;
        margin-right: 10px;
        margin-bottom: 10px;
    }
    
    .social-link:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .social-link.instagram:hover { background: #e4405f; color: white; }
    .social-link.youtube:hover { background: #cd201f; color: white; }
    .social-link.website:hover { background: #4e73df; color: white; }
    
    .form-section {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 25px;
        margin-bottom: 20px;
        border-left: 4px solid #28a745;
    }
    
    .section-title {
        color: #495057;
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .section-title i {
        color: #28a745;
    }
    
    .certificate-item {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .certificate-icon {
        width: 40px;
        height: 40px;
        background: #e8f5e9;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #28a745;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <!-- Заголовок профиля тренера -->
    <div class="trainer-header">
        <div class="row align-items-center">
            <div class="col-md-3 text-center">
                {% if current_user.profile.avatar_url %}
                    <img src="{{ current_user.profile.avatar_url }}" alt="Аватар тренера" class="trainer-avatar">
                {% else %}
                    <div class="trainer-avatar bg-white text-success d-flex align-items-center justify-content-center">
                        <i class="fas fa-user-tie fa-4x"></i>
                    </div>
                {% endif %}
            </div>
            <div class="col-md-9">
                <h1 class="mb-2">{{ current_user.full_name }}</h1>
                <p class="lead mb-2">{{ trainer.specialization }}</p>
                
                <!-- Рейтинг -->
                <div class="d-flex align-items-center mb-3">
                    <div class="rating-number me-3">{{ "%.1f"|format(trainer.rating) }}</div>
                    <div>
                        <div class="rating-stars">
                            {% for i in range(5) %}
                                {% if i < trainer.rating|int %}
                                    <i class="fas fa-star"></i>
                                {% elif i < trainer.rating|round %}
                                    <i class="fas fa-star-half-alt"></i>
                                {% else %}
                                    <i class="far fa-star"></i>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <div class="rating-count">
                            {{ trainer.total_ratings }} отзывов
                        </div>
                    </div>
                </div>
                
                <div class="d-flex flex-wrap gap-2">
                    <span class="badge bg-light text-dark">
                        <i class="fas fa-briefcase me-1"></i>{{ trainer.experience_years }} лет опыта
                    </span>
                    <span class="badge bg-light text-dark">
                        <i class="fas fa-users me-1"></i>{{ trainer.completed_sessions }} сессий
                    </span>
                    {% if trainer.hourly_rate %}
                        <span class="badge bg-light text-dark">
                            <i class="fas fa-money-bill-wave me-1"></i>{{ trainer.hourly_rate }} руб/час
                        </span>
                    {% endif %}
                    <span class="badge bg-{% if trainer.is_available %}success{% else %}secondary{% endif %}">
                        {% if trainer.is_available %}
                            <i class="fas fa-check-circle me-1"></i>Доступен
                        {% else %}
                            <i class="fas fa-times-circle me-1"></i>Не доступен
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Статистика тренера -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card stat-card">
                <div class="card-body text-center">
                    <div class="stat-icon bg-success bg-opacity-10 text-success mx-auto">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="stat-value">{{ trainer.completed_sessions }}</div>
                    <div class="stat-label">Проведено тренировок</div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-3">
            <div class="card stat-card">
                <div class="card-body text-center">
                    <div class="stat-icon bg-info bg-opacity-10 text-info mx-auto">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-value">{{ upcoming_trainings|length }}</div>
                    <div class="stat-label">Предстоящие тренировки</div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-3">
            <div class="card stat-card">
                <div class="card-body text-center">
                    <div class="stat-icon bg-warning bg-opacity-10 text-warning mx-auto">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="stat-value">{{ "%.1f"|format(trainer.rating) }}</div>
                    <div class="stat-label">Средний рейтинг</div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-3">
            <div class="card stat-card">
                <div class="card-body text-center">
                    <div class="stat-icon bg-primary bg-opacity-10 text-primary mx-auto">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-value">{% if trainer.hourly_rate %}{{ trainer.hourly_rate }}₽{% else %}—{% endif %}</div>
                    <div class="stat-label">Ставка в час</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Форма редактирования профиля тренера -->
    <form method="POST" action="{{ url_for('auth.trainer_profile') }}">
        {{ form.hidden_tag() }}
        
        <div class="row">
            <!-- Основная информация -->
            <div class="col-md-8">
                <div class="form-section">
                    <h5 class="section-title">
                        <i class="fas fa-user-tie"></i>Основная информация
                    </h5>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Специализация *</label>
                            {{ form.specialization(class="form-control", required=true) }}
                            {% if form.specialization.errors %}
                                <div class="text-danger small">
                                    {% for error in form.specialization.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Опыт работы (лет) *</label>
                            {{ form.experience_years(class="form-control", required=true, type="number", min="0") }}
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Ставка в час (руб)</label>
                            {{ form.hourly_rate(class="form-control", type="number", min="0", step="100") }}
                            <div class="form-text">Укажите 0 для бесплатных тренировок</div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Статус доступности</label>
                            <div class="form-check form-switch mt-2">
                                {{ form.is_available(class="form-check-input", role="switch") }}
                                <label class="form-check-label">
                                    Доступен для новых клиентов
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Сертификация *</label>
                        {{ form.certification(class="form-control", rows="3", required=true, 
                            placeholder="Перечислите ваши сертификаты и квалификации...") }}
                        <div class="form-text">Каждый сертификат с новой строки</div>
                    </div>
                </div>
                
                <!-- Образование и достижения -->
                <div class="form-section">
                    <h5 class="section-title">
                        <i class="fas fa-graduation-cap"></i>Образование и достижения
                    </h5>
                    
                    <div class="mb-3">
                        <label class="form-label">Образование</label>
                        {{ form.education(class="form-control", rows="4", 
                            placeholder="Образовательные учреждения, курсы повышения квалификации...") }}
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Достижения</label>
                        {{ form.achievements(class="form-control", rows="4", 
                            placeholder="Награды, спортивные достижения, публикации...") }}
                    </div>
                </div>
                
                <!-- Расписание -->
                <div class="form-section">
                    <h5 class="section-title">
                        <i class="fas fa-calendar-alt"></i>Рабочее расписание
                    </h5>
                    
                    <div class="mb-3">
                        <label class="form-label">Расписание работы</label>
                        {{ form.work_schedule(class="form-control", rows="3", 
                            placeholder="Пример: Пн-Пт: 9:00-18:00, Сб: 10:00-16:00, Вс: выходной") }}
                        <div class="form-text">Опишите ваше обычное рабочее расписание</div>
                    </div>
                </div>
            </div>
            
            <!-- Социальные сети и быстрые действия -->
            <div class="col-md-4">
                <!-- Социальные сети -->
                <div class="form-section">
                    <h5 class="section-title">
                        <i class="fas fa-share-alt"></i>Социальные сети
                    </h5>
                    
                    <div class="mb-3">
                        <label class="form-label">Веб-сайт</label>
                        {{ form.website(class="form-control", placeholder="https://ваш-сайт.ru") }}
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Instagram</label>
                        <div class="input-group">
                            <span class="input-group-text">@</span>
                            {{ form.instagram(class="form-control", placeholder="username") }}
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">YouTube</label>
                        {{ form.youtube(class="form-control", placeholder="Название канала или ссылка") }}
                    </div>
                    
                    <div class="d-flex flex-wrap">
                        {% if trainer.website %}
                            <a href="{{ trainer.website }}" target="_blank" class="social-link website" title="Веб-сайт">
                                <i class="fas fa-globe"></i>
                            </a>
                        {% endif %}
                        {% if trainer.instagram %}
                            <a href="https://instagram.com/{{ trainer.instagram }}" target="_blank" class="social-link instagram" title="Instagram">
                                <i class="fab fa-instagram"></i>
                            </a>
                        {% endif %}
                        {% if trainer.youtube %}
                            <a href="{{ trainer.youtube }}" target="_blank" class="social-link youtube" title="YouTube">
                                <i class="fab fa-youtube"></i>
                            </a>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Быстрые действия -->
                <div class="card mb-4">
                    <div class="card-header bg-light">
                        <h6 class="mb-0"><i class="fas fa-bolt me-2"></i>Быстрые действия</h6>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a href="{{ url_for('trainings.create_training') }}" class="btn btn-success">
                                <i class="fas fa-plus me-2"></i>Создать тренировку
                            </a>
                            <a href="{{ url_for('trainings.my_trainings', status='created') }}" class="btn btn-outline-primary">
                                <i class="fas fa-list me-2"></i>Мои тренировки
                            </a>
                            <a href="{{ url_for('trainings.calendar') }}" class="btn btn-outline-primary">
                                <i class="fas fa-calendar-alt me-2"></i>Календарь
                            </a>
                            <a href="{{ url_for('auth.profile') }}" class="btn btn-outline-secondary">
                                <i class="fas fa-user me-2"></i>Основной профиль
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- Предстоящие тренировки -->
                <div class="card">
                    <div class="card-header bg-light">
                        <h6 class="mb-0"><i class="fas fa-clock me-2"></i>Ближайшие тренировки</h6>
                    </div>
                    <div class="card-body">
                        {% if upcoming_trainings %}
                            {% for training in upcoming_trainings[:3] %}
                                <div class="d-flex align-items-center mb-3 pb-3 border-bottom">
                                    <div class="flex-shrink-0">
                                        <div class="bg-primary bg-opacity-10 text-primary rounded p-2">
                                            <i class="fas fa-running"></i>
                                        </div>
                                    </div>
                                    <div class="flex-grow-1 ms-3">
                                        <div class="fw-bold small">{{ training.title }}</div>
                                        <div class="text-muted small">
                                            {{ training.schedule_time.strftime('%d.%m.%Y %H:%M') }}
                                        </div>
                                        <div class="small">
                                            <span class="badge bg-primary">{{ training.registrations_count }}/{{ training.max_participants }}</span>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                            
                            {% if upcoming_trainings|length > 3 %}
                                <a href="{{ url_for('trainings.my_trainings', status='created') }}" class="btn btn-sm btn-outline-primary w-100">
                                    Все тренировки
                                </a>
                            {% endif %}
                        {% else %}
                            <p class="text-muted small mb-0">Нет предстоящих тренировок</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Кнопки сохранения -->
        <div class="d-flex justify-content-between mt-4">
            <a href="{{ url_for('main.index') }}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-1"></i>На главную
            </a>
            
            <div>
                <a href="{{ url_for('auth.profile') }}" class="btn btn-outline-primary me-2">
                    <i class="fas fa-user me-1"></i>Основной профиль
                </a>
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-save me-1"></i>Сохранить изменения
                </button>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Форматирование сертификатов
document.addEventListener('DOMContentLoaded', function() {
    const certificationField = document.querySelector('[name="certification"]');
    
    if (certificationField) {
        // При фокусе показываем подсказку
        certificationField.addEventListener('focus', function() {
            if (!this.getAttribute('data-hint-shown')) {
                this.setAttribute('placeholder', 'Каждый сертификат с новой строки\nПример:\n- Сертификат тренера по фитнесу\n- Курс по спортивной диетологии\n- Мастер-класс по йоге');
                this.setAttribute('data-hint-shown', 'true');
            }
        });
    }
    
    // Валидация URL
    const urlFields = document.querySelectorAll('[type="url"], [name*="website"], [name*="youtube"]');
    urlFields.forEach(field => {
        field.addEventListener('blur', function() {
            const value = this.value.trim();
            if (value && !value.startsWith('http://') && !value.startsWith('https://')) {
                this.value = 'https://' + value;
            }
        });
    });
});
</script>
{% endblock %}